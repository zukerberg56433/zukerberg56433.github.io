<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Violet's Basement</title>
  <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Source Code Pro", monospace;
      background-color: black;
      color: limegreen;
      font-size: 48px;
    }
  </style>
</head>
<body>
  <div id="binary-display">0000000000</div>

  <script>
    (function() {
      let count = 0;
      let previousBinarySet = "0000000000".split("");
      const notes = ["D4", "E4", "F4", "G4", "A5", "C5", "D5", "E5", "F5", "G5"];
      const times = [1.7, 1.5, 1.3, 1.2, 0.9, 0.7, 0.6, 0.5, 0.5, 0.4];

      const synth = new Tone.PolySynth({
        maxPolyphony: 8,
        voice: Tone.Synth,
        options: {
          oscillator: { partials: [0, 2, 3, 4] }
        }
      }).toDestination();

      const binaryDisplay = document.getElementById("binary-display");

      Tone.Transport.bpm.value = 50;

      Tone.Transport.scheduleRepeat((time) => {
        let binary = count.toString(2).padStart(10, "0");
        let binaryArray = binary.split("");

        binaryDisplay.textContent = binary;

        for (let i = 0; i < binaryArray.length; i++) {
          if (binaryArray[i] === "1" && previousBinarySet[i] !== "1") {
            synth.triggerAttackRelease(notes[i], times[i], time);
          }
        }

        previousBinarySet = binaryArray;
        count = (count + 1) % 1024;
      }, "32i");

      window.addEventListener("click", async () => {
        await Tone.start();
        Tone.Transport.start();
        console.log("Music started.");
      }, { once: true });
    })();
  </script>
</body>
</html>
