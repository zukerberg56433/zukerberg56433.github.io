<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Violet's Basement</title>
  <link rel="icon" type="image/png" href="cross.png" />
  <link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Jersey 10', monospace;
      user-select: none;
    }
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      background: black;
      cursor: pointer;
    }
    video#bg-video {
      position: fixed;
      right: 0;
      bottom: 0;
      min-width: 100%;
      min-height: 100%;
      z-index: -1;
      object-fit: cover;
    }
    audio {
      display: none;
    }
    #click-to-enter {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 28px;
      text-align: center;
      white-space: pre-wrap;
      z-index: 999;
    }
    #output {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      z-index: 10;
    }
    .line {
      font-size: 22px;
      white-space: pre-wrap;
      text-align: center;
      color: white;
    }
    #binary-display {
      font-size: 36px;
      color: white;
      margin-top: 30px;
      font-family: monospace;
      letter-spacing: 3px;
    }

    #sparkleCanvas {
      position: fixed;
      pointer-events: none;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 9999;
    }
  </style>
</head>
<body>

  <video autoplay muted loop id="bg-video">
    <source src="your-video.mp4" type="video/mp4" />
  </video>

  <audio id="bg-audio" loop preload="auto">
    <source src="music.mp3" type="audio/mp3" />
  </audio>

  <div id="click-to-enter">Click to Enter</div>

  <div id="output" style="display: none;">
    <div class="line">Welcome to Varsha's Basement</div>
    <div id="binary-display">0000000000</div>
  </div>

  <canvas id="sparkleCanvas"></canvas>

  <script>
    let hasStarted = false;
    const output = document.getElementById('output');
    const audioEl = document.getElementById('bg-audio');
    const binaryDisplay = document.getElementById('binary-display');

    document.body.addEventListener('click', () => {
      if (!hasStarted) {
        hasStarted = true;
        document.getElementById('click-to-enter').remove();
        output.style.display = 'flex';
        audioEl.play().catch(() => {});
        Tone.start().then(() => {
          startBinaryMusic(); // Start music
          startDisplay();     // Show device info
        });
      }
    });

    async function startDisplay() {
      let browserData = {};
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        browserData = {
          ip: data.ip || 'N/A',
          city: data.city || 'N/A',
          region: data.region || 'N/A',
          country: data.country_name || 'N/A',
          latitude: data.latitude || 'N/A',
          longitude: data.longitude || 'N/A',
          timezone: data.timezone || 'N/A',
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          language: navigator.language,
          screen: `${screen.width}x${screen.height}`
        };
      } catch {
        browserData = {
          ip: 'N/A',
          city: 'N/A',
          region: 'N/A',
          country: 'N/A',
          latitude: 'N/A',
          longitude: 'N/A',
          timezone: 'N/A',
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          language: navigator.language,
          screen: `${screen.width}x${screen.height}`
        };
      }

      const lines = () => [
        `IP Address: ${browserData.ip}`,
        `Device Info: ${browserData.platform}`,
        `Browser Info: ${browserData.userAgent}`,
        `Location: ${browserData.country}, ${browserData.region}, ${browserData.city}`,
        `Coordinates: ${browserData.latitude}, ${browserData.longitude}`,
        `Timezone: ${browserData.timezone}`,
        `Screen Size: ${browserData.screen}`,
        `Language: ${browserData.language}`
      ];

      const totalDuration = 2500;
      const fullText = lines().join('');
      const perCharDelay = totalDuration / fullText.length;

      for (const lineText of lines()) {
        const line = document.createElement('div');
        line.classList.add('line');
        output.insertBefore(line, binaryDisplay); // Insert above binary
        await typeFast(line, lineText, perCharDelay);
      }
    }

    async function typeFast(el, text, delay) {
      el.textContent = '';
      for (let i = 0; i <= text.length; i++) {
        el.textContent = text.slice(0, i);
        await sleep(delay);
      }
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function startBinaryMusic() {
      let count = 0;
      let previousBinarySet = "0000000000".split("");
      const notes = ["D4", "E4", "F4", "G4", "A5", "C5", "D5", "E5", "F5", "G5"];
      const times = [1.7, 1.5, 1.3, 1.2, 0.9, 0.7, 0.6, 0.5, 0.5, 0.4];

      const synth = new Tone.PolySynth({
        maxPolyphony: 8,
        voice: Tone.Synth,
        options: {
          oscillator: { partials: [0, 2, 3, 4] }
        }
      }).toDestination();

      Tone.Transport.bpm.value = 50;

      Tone.Transport.scheduleRepeat((time) => {
        let binary = count.toString(2).padStart(10, "0");
        let binaryArray = binary.split("");

        binaryDisplay.textContent = binary;

        for (let i = 0; i < binaryArray.length; i++) {
          if (binaryArray[i] === "1" && previousBinarySet[i] !== "1") {
            synth.triggerAttackRelease(notes[i], times[i], time);
          }
        }

        previousBinarySet = binaryArray;
        count = (count + 1) % 1024;
      }, "32i");

      Tone.Transport.start();
    }

    // Sparkle particles
    const canvas = document.getElementById('sparkleCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const colors = ['#ffffff', '#ffb3ba', '#bae1ff', '#baffc9', '#ffffba', '#ffdfba', '#d7baff'];

    document.addEventListener('mousemove', (e) => {
      for (let i = 0; i < 3; i++) {
        particles.push({
          x: e.clientX,
          y: e.clientY,
          size: Math.random() * 2 + 1,
          speedX: (Math.random() - 0.5) * 2,
          speedY: (Math.random() - 0.5) * 2,
          opacity: 1,
          color: colors[Math.floor(Math.random() * colors.length)]
        });
      }
    });

    function animateParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.speedX;
        p.y += p.speedY;
        p.opacity -= 0.02;
        if (p.opacity <= 0) {
          particles.splice(i, 1);
          continue;
        }
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(${hexToRgb(p.color)},${p.opacity})`;
        ctx.fill();
      }
      requestAnimationFrame(animateParticles);
    }

    function hexToRgb(hex) {
      const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
      hex = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b);
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ?
        parseInt(result[1], 16) + "," +
        parseInt(result[2], 16) + "," +
        parseInt(result[3], 16)
        : '255,255,255';
    }

    animateParticles();
  </script>

</body>
</html>
